library(plm)
install.packages("plm")
library(plm)
d=read.csv(file.choose())
vars <- c("idnum","panelwave","affrmact","race", "intrace1")
pd.sub <- d[, vars]
pd.sub$black = ifelse(pd.sub$race==2, 1, 0) ## this is if the person is black or not
pd.sub$intblack = ifelse(pd.sub$intrace1==2, 1, 0) ## this is if the interviewer is black or not
pd.sub$r.affact = 5-pd.sub$affrmact ## this is how people feel about What about your opinion "Do you favor preference in hiring and promotion strongly or not strongly for blacks? If opposes: Do you oppose preference in hiring and promotion strongly or not strongly?" ranging from strong support to strong opposition
pd.sub$year= ifelse(pd.sub$panelwave==3, 1, 0)
lm1 <- lm(r.affact ~ black + intblack + as.factor(panelwave),  data = pd.sub)
summary(lm1)
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
# compute variance-covariance matrix
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
# retest coefficients
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
summary(pd.sub$black)
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
library(plm)
d=read.csv(file.choose())
vars <- c("idnum","panelwave","affrmact","race", "intrace1")
pd.sub <- d[, vars]
pd.sub$black = ifelse(pd.sub$race==2, 1, 0) ## this is if the person is black or not
pd.sub$intblack = ifelse(pd.sub$intrace1==2, 1, 0) ## this is if the interviewer is black or not
pd.sub$r.affact = 5-pd.sub$affrmact ## this is how people feel about What about your opinion "Do you favor preference in hiring and promotion strongly or not strongly for blacks? If opposes: Do you oppose preference in hiring and promotion strongly or not strongly?" ranging from strong support to strong opposition
pd.sub$year= ifelse(pd.sub$panelwave==3, 1, 0)
lm1 <- lm(r.affact ~ black + intblack + as.factor(panelwave),  data = pd.sub)
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
#3. compute degrees of freedom
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
# compute variance-covariance matrix
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
# retest coefficients
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
View(pd.sub)
library(plm)
library(plyr)
library(psych)
library(VGAM)
head(pd.sub)
pd.sub$female = ifelse(pd.sub$sex==2, 1, 0)
head(pd.sub)
pd.sub$working = ifelse(pd.sub$wrkstat==1, 1, 0)
table(pd$wrkstat)
table(pd.sub$working)
pd.sub$r.fechld = 5-pd.sub$fechld
table(pd.sub$r.fechld)
table(pd$fechld)
lm1 <- lm(r.fechld ~ female + wrkstat + as.factor(panelwave),  data = pd.sub)
summmary(lm1)
summary(lm1)
library(plm)
library(plyr)
library(psych)
library(VGAM)
vars <- c("idnum","panelwave","affrmact","race", "intrace1")
pd.sub <- d[, vars]
pd.sub$black = ifelse(pd.sub$race==2, 1, 0) ## this is if the person is black or not
pd.sub$intblack = ifelse(pd.sub$intrace1==2, 1, 0) ## this is if the interviewer is black or not
pd.sub$r.affact = 5-pd.sub$affrmact ## this is how people feel about What about your opinion "Do you favor preference in hiring and promotion strongly or not strongly for blacks? If opposes: Do you oppose preference in hiring and promotion strongly or not strongly?" ranging from strong support to strong opposition
pd.sub$year= ifelse(pd.sub$panelwave==3, 1, 0)
lm1 <- lm(r.affact ~ black + intblack + as.factor(panelwave),  data = pd.sub)
summary(lm1)
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
#' clusterSE(fit, cluster.var = "state") # don't need data argument since "state" is included in index
#' }
#'
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
#3. compute degrees of freedom
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
# compute variance-covariance matrix
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
# retest coefficients
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
library(plm)
library(plyr)
library(psych)
library(VGAM)
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
#3. compute degrees of freedom
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
# compute variance-covariance matrix
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
# retest coefficients
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
library(plm)
summary(lm1)
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
library(plm)
library(plyr)
library(psych)
library(VGAM)
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
clusterSE <- function(fit, cluster.var, data){ # note: cluster.var should be entered as character string
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
# 1. get number of clusters (omitting individuals with missingness on "divorce.easier" and/or "divorced")
n <- length(unique(data[row.ids, cluster.var]))
# 2. get number of observations (again omitting the same individuals with missingness)
N <- length(row.ids)
}
#3. compute degrees of freedom
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
# compute variance-covariance matrix
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
# retest coefficients
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
library(plm)
library(plyr)
library(psych)
library(VGAM)
pd <- arrange(d,idnum,panelwave)
vars <- c("idnum","panelwave","fechld", "wrkstat", "sex")
pd.sub <- pd[, vars]
head(pd.sub)
pd.sub$female = ifelse(pd.sub$sex==2, 1, 0) ## if participant is female
pd.sub$working = ifelse(pd.sub$wrkstat==1, 1, 0) ## if participant is working
pd.sub$r.fechld = 5-pd.sub$fechld ## reverse code for how close a working mother can be to her child
pd.sub$year= ifelse(pd.sub$panelwave==3, 1, 0) ## lump years 2 and 1 together
lm1 <- lm(r.fechld ~ female + wrkstat,  data = pd.sub)
summary(lm1)
clusterSE <- function(fit, cluster.var, data){
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
n <- length(unique(data[row.ids, cluster.var]))
N <- length(row.ids)
}
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
library(plm)
library(plyr)
library(psych)
library(VGAM)
d=read.csv(file.choose())
pd <- arrange(d,idnum,panelwave)
vars <- c("idnum","panelwave","fechld", "wrkstat", "sex")
pd.sub <- pd[, vars]
head(pd.sub)
pd.sub$female = ifelse(pd.sub$sex==2, 1, 0) ## if participant is female
pd.sub$working = ifelse(pd.sub$wrkstat==1, 1, 0) ## if participant is working
pd.sub$r.fechld = 5-pd.sub$fechld ## reverse code for how close a working mother can be to her child
pd.sub$year= ifelse(pd.sub$panelwave==3, 1, 0) ## lump years 2 and 1 together
## 1. Run a naive ("pooled") OLS regression on the panel data.
lm1 <- lm(r.fechld ~ female + wrkstat,  data = pd.sub)
summary(lm1)
## clusters
clusterSE <- function(fit, cluster.var, data){
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
n <- length(unique(data[row.ids, cluster.var]))
N <- length(row.ids)
}
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
coeftest(fit, vcov = vcov)
}
summary(pd.sub$fechld)
table(pd.sub$fechld)
table(pd.sub$wrkstat)
table(pd.sub$sex)
pd <- arrange(d,idnum,panelwave)
vars <- c("idnum","panelwave","fechld", "wrkstat", "sex")
pd.sub <- pd[, vars]
head(pd.sub)
pd.sub$female = ifelse(pd.sub$sex==2, 1, 0) ## if participant is female
pd.sub$working = ifelse(pd.sub$wrkstat==1, 1, 0) ## if participant is working
pd.sub$r.fechld = 5-pd.sub$fechld ## reverse code for how close a working mother can be to her child
pd.sub$year= ifelse(pd.sub$panelwave==3, 1, 0) ## lump years 2 and 1 together
## 1. Run a naive ("pooled") OLS regression on the panel data.
lm1 <- lm(r.fechld ~ female + wrkstat,  data = pd.sub)
summary(lm1)
clusterSE <- function(fit, cluster.var, data){
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
n <- length(unique(data[row.ids, cluster.var]))
N <- length(row.ids)
}
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
plm1 <- plm(r.fechld ~ female + wrkstat,  index = c("idnum", "panelwave"),  model = "fd", data = pd.sub)
summary(plm1)
lm1 <- lm(r.fechld ~ female + working,  data = pd.sub)
summary(lm1)
clusterSE <- function(fit, cluster.var, data){
require(plm); require(lmtest)
if (missing(data) & cluster.var %in% colnames(index(fit))){
cvar <- index(fit, cluster.var)
n <- length(unique(cvar))
N <- length(cvar)
}
else{
row.ids <- as.numeric(rownames(model.frame(fit)))
n <- length(unique(data[row.ids, cluster.var]))
N <- length(row.ids)
}
df <- (n/(n - 1)) * (N - 1)/fit$df.residual
vcov <- df*vcovHC(fit, type = "HC0", cluster = "group")
coeftest(fit, vcov = vcov)
}
clusterSE(fit = lm1, cluster.var = "idnum", data=pd.sub)
lm.test <- plm(r.fechld ~ female + working, data = pd.sub, index = c("idnum", "panelwave"), model = "pooling")
summary(lm.test)
plm1 <- plm(r.fechld ~ female + working,  index = c("idnum", "panelwave"),  model = "fd", data = pd.sub)
summary(plm1)
clusterSE(fit = plm1, cluster.var = "idnum", data=pd.sub)
plm1 <- plm(r.fechld ~ female + working + year,  index = c("idnum", "panelwave"),  model = "fd", data = pd.sub)
summary(plm1)
clusterSE(fit = plm1, cluster.var = "idnum", data=pd.sub)
